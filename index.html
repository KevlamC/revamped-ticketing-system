<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>THEATRUM - Premium Cinema Experience</title>

  <link rel="stylesheet" href="styles/index_styles.css" />
  <link rel="stylesheet" href="styles/hero.css" />
  <link rel="stylesheet" href="styles/offers.css" />
  <link rel="stylesheet" href="styles/experience.css" />

  <!-- Critical-path modal styles kept minimal here -->
  <style>
  /* Critical modal/calendar styles (keep minimal inline) */
  /* Keep hero-bg here (carousel uses this element) */
  .hero-bg{position:absolute;inset:0;background-size:cover;background-position:center top;transition:opacity .3s ease;opacity:1}
    .overlay{position:fixed;inset:0;background:rgba(10,10,15,.6);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;z-index:2000}
    .overlay.show{display:flex}
    .sheet{width:min(680px,92vw);background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:28px;box-shadow:var(--shadow-2);animation:modal-pop 220ms ease-out;position:relative}
    @keyframes modal-pop{from{transform:scale(.98);opacity:.5}}
    .close-x{position:absolute;top:14px;right:14px;cursor:pointer;width:38px;height:38px;border-radius:10px;display:grid;place-items:center;background:var(--bg-secondary);border:1px solid var(--border);color:var(--text-secondary)}
    .stack{display:grid;gap:12px}
    .grid-2{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .field{display:grid;gap:6px}
    .field label{font-size:13px;color:var(--text-secondary)}
    .field input{background:var(--bg-secondary);border:1px solid var(--border);border-radius:8px;padding:12px 14px;color:var(--text-primary)}
    .btn-row{display:flex;gap:10px;flex-wrap:wrap}
    .btn-chip{background:var(--bg-secondary);border:1px solid var(--border);color:var(--text-secondary);padding:8px 14px;border-radius:999px;font-weight:700;cursor:pointer}
    .btn-chip:hover{background:var(--accent-red);color:#fff;border-color:var(--accent-red)}
    .error{color:#fda4af;font-size:13px;display:none}
    .error.show{display:block}
    .success{background:rgba(16,185,129,.12);color:#a7f3d0;border:1px solid rgba(16,185,129,.35);padding:10px 12px;border-radius:10px;font-size:14px;display:none}
    .success.show{display:block}
    .bottom-sheet{position:fixed;left:0;right:0;bottom:0;background:var(--bg-card);border-top:1px solid var(--border);border-radius:16px 16px 0 0;transform:translateY(100%);transition:transform .24s ease;z-index:1900;padding:20px 18px 28px;max-height:80vh;overflow:auto}
    .bottom-sheet.show{transform:translateY(0)}
    .sheet-head{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:12px}
    .sheet-head h4{font-size:18px;font-weight:800;margin:0}
    .kicker{color:var(--text-muted);font-size:12px;letter-spacing:1.2px}
    .date-row,.showtime-row{display:flex;gap:8px;flex-wrap:wrap}
    .pill{background:var(--bg-secondary);border:1px solid var(--border);color:var(--text-secondary);padding:8px 14px;border-radius:999px;cursor:pointer;font-weight:700}
    .pill.selected{background:var(--accent-red);color:#fff;border-color:var(--accent-red)}
    .calendar-dropdown{background:var(--bg-secondary);border:1px solid var(--border);border-radius:10px;padding:12px;margin-top:8px}
    .calendar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:8px}
    .calendar-header button{background:var(--bg-tertiary);border:1px solid var(--border);color:var(--text-primary);padding:6px 12px;border-radius:6px;cursor:pointer}
    .calendar-header button:hover{background:var(--accent-red);border-color:var(--accent-red)}
    .calendar-header span{font-weight:700;font-size:14px;color:var(--text-primary);flex:1;text-align:center}
    .calendar-day-headers{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:8px;text-align:center}
    .calendar-day-headers div{font-weight:700;font-size:12px;color:var(--text-secondary);padding:6px 0}
  .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
    .dropdown-calendar-day{background:var(--bg-tertiary);border:1px solid var(--border);color:var(--text-secondary);padding:8px;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;text-align:center}
    .dropdown-calendar-day:hover:not(.unavailable){background:var(--bg-quaternary);border-color:var(--text-secondary)}
    .dropdown-calendar-day.available{color:var(--text-primary)}
    .dropdown-calendar-day.today{background:var(--accent-red);color:#fff;border-color:var(--accent-red)}
    .dropdown-calendar-day.selected{background:var(--accent-red);color:#fff;border-color:var(--accent-red);font-weight:800}
    .dropdown-calendar-day.unavailable{background:var(--bg-secondary);color:var(--text-muted);cursor:not-allowed;opacity:.5}
    .user-icon-btn{padding:10px 16px}
    .user-icon-btn.icon-mode{width:42px;height:42px;padding:0;display:grid;place-items:center}
    .user-icon-btn .user-icon{font-size:18px;line-height:1}
  </style>
</head>

<body>
  <!-- NAV -->
  <div id="header-placeholder"></div>
  <script src="scripts/load-header.js"></script>

  <!-- HERO -->
  <section class="hero">
  <!-- Hero background used by the carousel script -->
  <div id="hero-image" class="hero-bg" aria-hidden="true"></div>
  <div id="hero-video" class="hero-video-wrapper"></div>
  <div class="hero-overlay"></div>

    <!-- nav controls and dots for hero slider -->
    <div class="hero-controls" aria-hidden="false">
      <button id="hero-prev" class="hero-nav" aria-label="Previous">â€¹</button>
      <div id="hero-dots" class="hero-dots" aria-hidden="false"></div>
      <button id="hero-next" class="hero-nav" aria-label="Next">â€º</button>
    </div>

    <div class="hero-content">
      <span class="hero-label">NOW SHOWING</span>
      <h1 id="hero-title" class="hero-title">DUNE: PART TWO</h1>
      <p id="hero-subtitle" class="hero-description">Experience the epic conclusion on the biggest screen with Dolby Atmos sound</p>
      <div class="hero-buttons">
        <button id="hero-cta" class="btn-primary btn-large">Get Tickets</button>
        <button id="hero-trailer" class="btn-secondary btn-large">Watch Trailer</button>
      </div>
      <div class="hero-info">
        <span id="hero-rating" class="info-badge">PG-13</span>
        <span id="hero-duration" class="info-item">2h 46m</span>
        <span id="hero-genre" class="info-item">Sci-Fi, Adventure</span>
        <span id="hero-score" class="info-item">â˜… 8.7/10</span>
      </div>
    </div>
  </section>

  <!-- NOW PLAYING -->
  <section class="now-playing section-block" id="now-playing">
    <div class="container">
      <div class="section-header">
        <div>
          <h2>Now Playing</h2>
          <p class="section-subtitle">TODAY â€¢ PREMIUM FORMATS â€¢ DOLBY ATMOS</p>
        </div>
      </div>

      <div class="filter-bar-container">
        <!-- 1. Date Dropdown -->
        <div class="filter-dropdown" id="dateDropdown">
          <button class="dropdown-trigger" onclick="toggleDropdown('dateDropdown')">
            <span id="selectedDateLabel">Date</span> 
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </button>
          <div class="dropdown-menu" id="dateOptions">
            <div class="dropdown-item" data-val="all" onclick="selectDate('all')">All Dates</div>
            <div class="dropdown-item" data-val="today" onclick="selectDate('today')">Today</div>
            <div class="dropdown-item" data-val="tomorrow" onclick="selectDate('tomorrow')">Tomorrow</div>
            <div class="v-sep" style="width:100%; height:1px; margin:4px 0; background:var(--border)"></div>
            
            <!-- Embedded Calendar -->
            <div class="calendar-in-dropdown">
              <div class="calendar-header">
                <button id="dropdownPrevBtn" class="calendar-nav-mini">â€¹</button>
                <span id="dropdownMonthYear" class="calendar-month-year">December 2025</span>
                <button id="dropdownNextBtn" class="calendar-nav-mini">â€º</button>
              </div>
              <div class="calendar-day-headers">
                <div>Sun</div>
                <div>Mon</div>
                <div>Tue</div>
                <div>Wed</div>
                <div>Thu</div>
                <div>Fri</div>
                <div>Sat</div>
              </div>
              <div id="dropdownCalendarGrid" class="calendar-grid"></div>
            </div>
          </div>
        </div>

        <!-- 2. Time Range Filter -->
        <div class="time-range-filter">
          <button class="time-range-trigger" id="timeRangeTrigger">
            <span id="timeRangeLabel">10:00 AM - 10:00 PM</span>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </button>
          <div class="time-range-menu" id="timeRangeMenu">
            <div class="time-range-options">
              <div class="time-column" id="startTimeColumn">
                <div class="time-label">Start Time</div>
              </div>
              <div class="time-divider">â€”</div>
              <div class="time-column" id="endTimeColumn">
                <div class="time-label">End Time</div>
              </div>
            </div>
            <button class="btn-apply-time" id="applyTimeBtn">Apply</button>
          </div>
        </div>

        <div class="v-sep"></div>

        <!-- 2. Genre Dropdown -->
        <div class="filter-dropdown" id="genreDropdown">
          <button class="dropdown-trigger" onclick="toggleDropdown('genreDropdown')">
            Genre 
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </button>
          <div class="dropdown-menu" id="genreMenu">
            <label class="dropdown-item"><input type="checkbox" value="Action"> Action</label>
            <label class="dropdown-item"><input type="checkbox" value="Adventure"> Adventure</label>
            <label class="dropdown-item"><input type="checkbox" value="Comedy"> Comedy</label>
            <label class="dropdown-item"><input type="checkbox" value="Drama"> Drama</label>
            <label class="dropdown-item"><input type="checkbox" value="Horror"> Horror</label>
            <label class="dropdown-item"><input type="checkbox" value="Sci-Fi"> Sci-Fi</label>
            <label class="dropdown-item"><input type="checkbox" value="Thriller"> Thriller</label>
          </div>
        </div>

        <!-- 3. Experience Dropdown -->
        <div class="filter-dropdown" id="formatDropdown">
          <button class="dropdown-trigger" onclick="toggleDropdown('formatDropdown')">
            Format 
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </button>
          <div class="dropdown-menu" id="formatMenu">
            <label class="dropdown-item"><input type="checkbox" value="IMAX"> IMAX</label>
            <label class="dropdown-item"><input type="checkbox" value="DOLBY"> Dolby Cinema</label>
            <label class="dropdown-item"><input type="checkbox" value="3D"> 3D</label>
            <label class="dropdown-item"><input type="checkbox" value="70MM"> 70MM</label>
            <label class="dropdown-item"><input type="checkbox" value="VIP"> VIP</label>
          </div>
        </div>

        <!-- 4. Sort Dropdown (Custom Styled) -->
        <div class="filter-dropdown sort-group" id="sortDropdown">
          <button class="dropdown-trigger" onclick="toggleDropdown('sortDropdown')">
            <span id="sortLabel">Sort by Showtime</span>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </button>
          <div class="dropdown-menu" style="right:0; left:auto;">
            <div class="dropdown-item" onclick="applySort('showtime', 'Sort by Showtime')">Showtime (Earliest)</div>
            <div class="dropdown-item" onclick="applySort('title', 'Sort by Title')">Title (A-Z)</div>
            <div class="dropdown-item" onclick="applySort('rating', 'Sort by Rating')">Rating (High-Low)</div>
            <div class="dropdown-item" onclick="applySort('release', 'Sort by Release')">Release Date</div>
          </div>
        </div>
      </div>

      <div class="movies-grid" id="moviesGrid">
        
        <!-- Card 1: Dune Part Two -->
        <div class="movie-card" data-title="Dune: Part Two" data-rating="8.7" data-release="2024-03-01" data-genres="Sci-Fi,Adventure,Drama" data-duration="2h 46m" data-trailer="Way9Dexny3w" data-formats="IMAX,DOLBY">
          <div class="movie-poster">
            <img src="Pictures/dune2-poster.jpg" alt="Dune: Part Two">
            <div class="movie-overlay">
              <button class="btn-trailer-pill" data-action="trailer" aria-label="Watch Trailer">
                <div class="icon-zone">
                  <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </div>
                <span class="label">Watch Trailer</span>
              </button>
            </div>
            <div class="format-badges">
              <span class="format-badge imax">IMAX</span>
              <span class="format-badge dolby">DOLBY</span>
            </div>
          </div>
          <div class="movie-info">
            <h3>Dune: Part Two</h3>
            
            <div class="movie-meta-row">
              <div class="meta-item rating">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <span>8.7</span>
              </div>
              <div class="meta-separator"></div>
              <div class="meta-item duration">2h 46m</div>
              <div class="meta-separator"></div>
              <div class="meta-item">PG-13</div>
            </div>

            <div class="genres-block">
              <div class="genre-label">Genre</div>
              <div class="genres-list">Sci-Fi, Adventure, Drama</div>
            </div>

            <div class="showtimes-block">
              <div class="time-label">Today</div>
              <div class="showtimes">
                <button class="showtime-btn book-btn" data-movie="Dune: Part Two">2:00 PM</button>
                <button class="showtime-btn book-btn" data-movie="Dune: Part Two">5:30 PM</button>
                <button class="showtime-btn book-btn" data-movie="Dune: Part Two">9:00 PM</button>
              </div>
            </div>

            <div class="card-actions">
              <button class="btn-card-action btn-card-primary book-btn" data-movie="Dune: Part Two">Book Ticket</button>
              <button class="btn-card-action btn-card-secondary" data-action="view" data-movie="Dune: Part Two">View Details</button>
            </div>
          </div>
        </div>

        <!-- Card 2: Oppenheimer -->
        <div class="movie-card" data-title="Oppenheimer" data-rating="8.5" data-release="2023-07-21" data-genres="Drama,Biography,History" data-duration="3h 00m" data-trailer="uYPbbksJxIg" data-formats="70MM,IMAX">
          <div class="movie-poster">
            <img src="Pictures/opp-poster.jpg" alt="Oppenheimer">
            <div class="movie-overlay">
              <button class="btn-trailer-pill" data-action="trailer" aria-label="Watch Trailer">
                <div class="icon-zone">
                  <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </div>
                <span class="label">Watch Trailer</span>
              </button>
            </div>
            <div class="format-badges">
              <span class="format-badge premium">70MM</span>
              <span class="format-badge imax">IMAX</span>
            </div>
          </div>
          <div class="movie-info">
            <h3>Oppenheimer</h3>
            <div class="movie-meta-row">
              <div class="meta-item rating">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <span>8.5</span>
              </div>
              <div class="meta-separator"></div>
              <div class="meta-item duration">3h 00m</div>
              <div class="meta-separator"></div>
              <div class="meta-item">R</div>
            </div>

            <div class="genres-block">
              <div class="genre-label">Genre</div>
              <div class="genres-list">Drama, Biography, History</div>
            </div>

            <div class="showtimes-block">
              <div class="time-label">Today</div>
              <div class="showtimes">
                <button class="showtime-btn book-btn" data-movie="Oppenheimer">1:00 PM</button>
                <button class="showtime-btn book-btn" data-movie="Oppenheimer">4:30 PM</button>
                <button class="showtime-btn book-btn" data-movie="Oppenheimer">8:00 PM</button>
              </div>
            </div>
            <div class="card-actions">
              <button class="btn-card-action btn-card-primary book-btn" data-movie="Oppenheimer">Book Ticket</button>
              <button class="btn-card-action btn-card-secondary" data-action="view" data-movie="Oppenheimer">View Details</button>
            </div>
          </div>
        </div>

        <!-- Card 3: The Batman -->
        <div class="movie-card" data-title="The Batman" data-rating="8.2" data-release="2022-03-04" data-genres="Action,Crime,Thriller" data-duration="2h 56m" data-trailer="mqqft2x_Aa4" data-formats="DOLBY,4DX">
          <div class="movie-poster">
            <img src="Pictures/3de84cca07fc963b66a01a5465c2638066119711e89c707ce952555783dd4b4f-2.jpg" alt="The Batman">
            <div class="movie-overlay">
              <button class="btn-trailer-pill" data-action="trailer" aria-label="Watch Trailer">
                <div class="icon-zone">
                  <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </div>
                <span class="label">Watch Trailer</span>
              </button>
            </div>
            <div class="format-badges">
              <span class="format-badge dolby">DOLBY</span>
            </div>
          </div>
          <div class="movie-info">
            <h3>The Batman</h3>
            <div class="movie-meta-row">
              <div class="meta-item rating">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <span>8.2</span>
              </div>
              <div class="meta-separator"></div>
              <div class="meta-item duration">2h 56m</div>
              <div class="meta-separator"></div>
              <div class="meta-item">PG-13</div>
            </div>

            <div class="genres-block">
              <div class="genre-label">Genre</div>
              <div class="genres-list">Action, Crime, Thriller</div>
            </div>

            <div class="showtimes-block">
              <div class="time-label">Today</div>
              <div class="showtimes">
                <button class="showtime-btn book-btn" data-movie="The Batman">3:00 PM</button>
                <button class="showtime-btn book-btn" data-movie="The Batman">6:30 PM</button>
                <button class="showtime-btn book-btn" data-movie="The Batman">10:00 PM</button>
              </div>
            </div>
            <div class="card-actions">
              <button class="btn-card-action btn-card-primary book-btn" data-movie="The Batman">Book Ticket</button>
              <button class="btn-card-action btn-card-secondary" data-action="view" data-movie="The Batman">View Details</button>
            </div>
          </div>
        </div>

        <!-- Card 4: Barbie -->
        <div class="movie-card" data-title="Barbie" data-rating="7.9" data-release="2023-07-21" data-genres="Comedy,Fantasy,Adventure" data-duration="1h 54m" data-trailer="pBk4NYhUOQ0" data-formats="STD">
          <div class="movie-poster">
            <img src="Pictures/p13472534_p_v8_am.jpg" alt="Barbie">
            <div class="movie-overlay">
              <button class="btn-trailer-pill" data-action="trailer" aria-label="Watch Trailer">
                <div class="icon-zone">
                  <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </div>
                <span class="label">Watch Trailer</span>
              </button>
            </div>
            <div class="format-badges">
              <span class="format-badge">STD</span>
            </div>
          </div>
          <div class="movie-info">
            <h3>Barbie</h3>
            <div class="movie-meta-row">
              <div class="meta-item rating">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <span>7.9</span>
              </div>
              <div class="meta-separator"></div>
              <div class="meta-item duration">1h 54m</div>
              <div class="meta-separator"></div>
              <div class="meta-item">PG-13</div>
            </div>

            <div class="genres-block">
              <div class="genre-label">Genre</div>
              <div class="genres-list">Comedy, Fantasy, Adventure</div>
            </div>

            <div class="showtimes-block">
              <div class="time-label">Today</div>
              <div class="showtimes">
                <button class="showtime-btn book-btn" data-movie="Barbie">1:30 PM</button>
                <button class="showtime-btn book-btn" data-movie="Barbie">4:00 PM</button>
                <button class="showtime-btn book-btn" data-movie="Barbie">7:30 PM</button>
              </div>
            </div>
            <div class="card-actions">
              <button class="btn-card-action btn-card-primary book-btn" data-movie="Barbie">Book Ticket</button>
              <button class="btn-card-action btn-card-secondary" data-action="view" data-movie="Barbie">View Details</button>
            </div>
          </div>
        </div>

        <!-- Card 5: Killers of the Flower Moon -->
        <div class="movie-card" data-title="Killers of the Flower Moon" data-rating="8.1" data-release="2023-10-20" data-genres="Drama,Crime,History" data-duration="3h 26m" data-trailer="EP34Yoxs3FQ" data-formats="VIP,DOLBY">
          <div class="movie-poster">
            <img src="Pictures/ems.cHJkLWVtcy1hc3NldHMvbW92aWVzLzZhOWE1N2ZkLTY4MzgtNDA3Yi05MDEwLWQzN2QwMTFkZDdmNS5qcGc.jpeg" alt="Killers of the Flower Moon">
            <div class="movie-overlay">
              <button class="btn-trailer-pill" data-action="trailer" aria-label="Watch Trailer">
                <div class="icon-zone">
                  <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </div>
                <span class="label">Watch Trailer</span>
              </button>
            </div>
            <div class="format-badges">
              <span class="format-badge premium">VIP</span>
            </div>
          </div>
          <div class="movie-info">
            <h3>Killers of the Flower Moon</h3>
            <div class="movie-meta-row">
              <div class="meta-item rating">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <span>8.1</span>
              </div>
              <div class="meta-separator"></div>
              <div class="meta-item duration">3h 26m</div>
              <div class="meta-separator"></div>
              <div class="meta-item">R</div>
            </div>

            <div class="genres-block">
              <div class="genre-label">Genre</div>
              <div class="genres-list">Drama, Crime, History</div>
            </div>

            <div class="showtimes-block">
              <div class="time-label">Today</div>
              <div class="showtimes">
                <button class="showtime-btn book-btn" data-movie="Killers of the Flower Moon">2:30 PM</button>
                <button class="showtime-btn book-btn" data-movie="Killers of the Flower Moon">6:00 PM</button>
                <button class="showtime-btn book-btn" data-movie="Killers of the Flower Moon">9:30 PM</button>
              </div>
            </div>
            <div class="card-actions">
              <button class="btn-card-action btn-card-primary book-btn" data-movie="Killers of the Flower Moon">Book Ticket</button>
              <button class="btn-card-action btn-card-secondary" data-action="view" data-movie="Killers of the Flower Moon">View Details</button>
            </div>
          </div>
        </div>

        <!-- Card 6: A Quiet Place: Day One -->
        <div class="movie-card" data-title="A Quiet Place: Day One" data-rating="7.8" data-release="2024-06-28" data-genres="Horror,Thriller,Sci-Fi" data-duration="1h 40m" data-trailer="YPY7J-flzE8" data-formats="3D,DOLBY">
          <div class="movie-poster">
            <img src="Pictures/ems.cHJkLWVtcy1hc3NldHMvbW92aWVzLzIyNDlkYjk2LTUwZmQtNDgzOS04ZGIyLWI3NzZlMWE0OGNkNi5qcGc.jpeg" alt="A Quiet Place: Day One">
            <div class="movie-overlay">
              <button class="btn-trailer-pill" data-action="trailer" aria-label="Watch Trailer">
                <div class="icon-zone">
                  <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </div>
                <span class="label">Watch Trailer</span>
              </button>
            </div>
            <div class="format-badges">
              <span class="format-badge">3D</span>
            </div>
          </div>
          <div class="movie-info">
            <h3>A Quiet Place: Day One</h3>
            <div class="movie-meta-row">
              <div class="meta-item rating">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <span>7.8</span>
              </div>
              <div class="meta-separator"></div>
              <div class="meta-item duration">1h 40m</div>
              <div class="meta-separator"></div>
              <div class="meta-item">PG-13</div>
            </div>

            <div class="genres-block">
              <div class="genre-label">Genre</div>
              <div class="genres-list">Horror, Thriller, Sci-Fi</div>
            </div>

            <div class="showtimes-block">
              <div class="time-label">Today</div>
              <div class="showtimes">
                <button class="showtime-btn book-btn" data-movie="A Quiet Place: Day One">3:30 PM</button>
                <button class="showtime-btn book-btn" data-movie="A Quiet Place: Day One">7:00 PM</button>
                <button class="showtime-btn book-btn" data-movie="A Quiet Place: Day One">10:30 PM</button>
              </div>
            </div>
            <div class="card-actions">
              <button class="btn-card-action btn-card-primary book-btn" data-movie="A Quiet Place: Day One">Book Ticket</button>
              <button class="btn-card-action btn-card-secondary" data-action="view" data-movie="A Quiet Place: Day One">View Details</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Now Playing -->
  <section class="coming-soon section-block" id="coming-soon">
    <div class="container">
      <div class="section-header">
        <div>
          <h2>Now Playing</h2>
          <p class="section-subtitle">UPCOMING RELEASES</p>
        </div>
      </div>

      <!-- Carousel Container -->
      <div class="coming-soon-carousel-wrapper">
        <button class="carousel-nav carousel-nav-prev" id="comingSoonPrev" aria-label="Previous">â€¹</button>
        
        <div class="coming-soon-carousel">
          <div class="coming-soon-grid" id="comingSoonGrid">
            <!-- Card 1: Deadpool & Wolverine -->
            <div class="coming-card" data-release-date="2025-07-26" data-title="Deadpool & Wolverine" data-trailer="xJ7L1TxYy6E">
              <div class="coming-poster">
                <img src="Pictures/deadpool&wolverine-poster.jpg" alt="Deadpool & Wolverine">
                <div class="coming-date"><span class="date-month">JUL</span><span class="date-day">26</span></div>
                <div class="poster-overlay">
                  <button class="btn-trailer-pill" data-action="trailer" aria-label="Watch Trailer">
                    <div class="icon-zone">
                      <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </div>
                    <span class="label">Watch Trailer</span>
                  </button>
                </div>
              </div>
              <div class="coming-info">
                <h3>Deadpool & Wolverine</h3>
                <p class="coming-description">The Merc with a Mouth returns with an unlikely ally</p>
                <div class="genres-block">
                  <div class="genre-label">Genre</div>
                  <div class="genres-list">Action, Comedy</div>
                </div>
                <div class="coming-card-divider"></div>
                <button class="btn-notify">Notify Me</button>
              </div>
            </div>

            <!-- Card 2: Gladiator II -->
            <div class="coming-card" data-release-date="2025-11-22" data-title="Gladiator II" data-trailer="h1nwvCPL-hQ">
              <div class="coming-poster">
                <img src="Pictures/MV5BNmJlZGIzMjEtZWE0NS00NTAxLWIyNGItNjYzYzhjMmI3ZWVmXkEyXkFqcGc@._V1_FMjpg_UX1000_.jpg" alt="Gladiator II">
                <div class="coming-date"><span class="date-month">NOV</span><span class="date-day">22</span></div>
                <div class="poster-overlay">
                  <button class="btn-trailer-pill" data-action="trailer" aria-label="Watch Trailer">
                    <div class="icon-zone">
                      <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </div>
                    <span class="label">Watch Trailer</span>
                  </button>
                </div>
              </div>
              <div class="coming-info">
                <h3>Gladiator II</h3>
                <p class="coming-description">The epic saga continues with a new generation</p>
                <div class="genres-block">
                  <div class="genre-label">Genre</div>
                  <div class="genres-list">Drama, Action</div>
                </div>
                <div class="coming-card-divider"></div>
                <button class="btn-notify">Notify Me</button>
              </div>
            </div>

            <!-- Card 3: Wicked -->
            <div class="coming-card" data-release-date="2025-12-25" data-title="Wicked" data-trailer="tSKvH7bkPvg">
              <div class="coming-poster">
                <img src="Pictures/896d0b12-9ebf-4064-a121-f4294531c9c6.jpg" alt="Wicked">
                <div class="coming-date"><span class="date-month">DEC</span><span class="date-day">25</span></div>
                <div class="poster-overlay">
                  <button class="btn-trailer-pill" data-action="trailer" aria-label="Watch Trailer">
                    <div class="icon-zone">
                      <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </div>
                    <span class="label">Watch Trailer</span>
                  </button>
                </div>
              </div>
              <div class="coming-info">
                <h3>Wicked</h3>
                <p class="coming-description">The untold story of the Witches of Oz</p>
                <div class="genres-block">
                  <div class="genre-label">Genre</div>
                  <div class="genres-list">Fantasy, Musical</div>
                </div>
                <div class="coming-card-divider"></div>
                <button class="btn-notify">Notify Me</button>
              </div>
            </div>
          </div>
        </div>

        <button class="carousel-nav carousel-nav-next" id="comingSoonNext" aria-label="Next">â€º</button>
      </div>
    </div>
  </section>

  <!-- Offers -->
  <section class="offers section-block" id="offers">
    <div class="container">
      <div class="section-header">
        <div>
          <h2>Special Offers</h2>
          <p class="section-subtitle">EXCLUSIVE DEALS FOR THEATRUM FANS</p>
        </div>
      </div>

      <div class="offers-grid">
        <!-- Offer 1: Flash Deal -->
        <div class="offer-card offer-flash">
          <div class="offer-header">
            <div class="offer-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
            </div>
            <div class="offer-badge flash-badge">ENDS SOON</div>
          </div>
          <h3>Midweek Flash Sale</h3>
          <p class="offer-discount">25% Off</p>
          <p class="offer-description">All tickets on Wednesday & Thursday</p>
          <p class="offer-validity">Valid through December 31, 2025</p>
          <button class="btn-offer">Book Now</button>
        </div>

        <!-- Offer 2: Premium Pass -->
        <div class="offer-card offer-premium">
          <div class="offer-header">
            <div class="offer-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                <line x1="7" y1="7" x2="7.01" y2="7"></line>
              </svg>
            </div>
            <div class="offer-badge premium-badge">BEST VALUE</div>
          </div>
          <h3>Premium Pass</h3>
          <p class="offer-discount">$24.99/mo</p>
          <p class="offer-description">Unlimited screenings including IMAX & Dolby</p>
          <p class="offer-validity">Cancel anytime, first month free</p>
          <button class="btn-offer btn-offer-primary">Join Now</button>
        </div>

        <!-- Offer 3: Bundle Deal -->
        <div class="offer-card offer-bundle">
          <div class="offer-header">
            <div class="offer-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4"></path>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <path d="M16 8a4 4 0 0 1-8 0"></path>
              </svg>
            </div>
            <div class="offer-badge bundle-badge">SAVE $5</div>
          </div>
          <h3>Snack Combo</h3>
          <p class="offer-discount">$15</p>
          <p class="offer-description">Large popcorn + 2 drinks with any ticket</p>
          <p class="offer-validity">Valid daily all year round</p>
          <button class="btn-offer">Add to Order</button>
        </div>

        <!-- Offer 4: Member Exclusive -->
        <div class="offer-card offer-member">
          <div class="offer-header">
            <div class="offer-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </div>
            <div class="offer-badge member-badge">MEMBERS</div>
          </div>
          <h3>Birthday Bonus</h3>
          <p class="offer-discount">1 Free Ticket</p>
          <p class="offer-description">Plus $10 concession credit on your birthday month</p>
          <p class="offer-validity">Join membership to activate</p>
          <button class="btn-offer">Learn More</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Experience -->
  <section class="experience section-block" id="experience">
    <div class="container">
      <div class="section-header">
        <div>
          <h2>The THEATRUM Experience</h2>
          <p class="section-subtitle">PREMIUM TECHNOLOGY & UNMATCHED COMFORT</p>
        </div>
      </div>

      <div class="experience-grid">
        <!-- Visual Technology -->
        <div class="experience-card exp-visual">
          <div class="exp-category">VISUAL</div>
          <div class="experience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect>
              <polyline points="17 2 12 7 7 2"></polyline>
            </svg>
          </div>
          <h3>IMAX Screens</h3>
          <p class="exp-spec">Up to 8 stories tall</p>
          <p class="exp-description">Crystal-clear 4K resolution with 40% more image than standard screens for epic cinematic moments</p>
          <div class="exp-badge">Award-Winning</div>
        </div>

        <!-- Audio Technology -->
        <div class="experience-card exp-audio">
          <div class="exp-category">AUDIO</div>
          <div class="experience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
              <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
              <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
            </svg>
          </div>
          <h3>Dolby Atmos</h3>
          <p class="exp-spec">360Â° Immersive Sound</p>
          <p class="exp-description">Revolutionary audio technology that creates a three-dimensional soundscape surrounding you completely</p>
          <div class="exp-badge">Multi-Channel</div>
        </div>

        <!-- Comfort Technology -->
        <div class="experience-card exp-comfort">
          <div class="exp-category">COMFORT</div>
          <div class="experience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="8" width="18" height="12" rx="2"></rect>
              <path d="M10 8V5c0-1.1.9-2 2-2s2 .9 2 2v3"></path>
              <line x1="7" y1="12" x2="17" y2="12"></line>
            </svg>
          </div>
          <h3>Luxury Recliners</h3>
          <p class="exp-spec">Electric with Leg Rest</p>
          <p class="exp-description">Premium seating that adjusts to your perfect angle with ample leg room and heated cushions</p>
          <div class="exp-badge">Premium Seats</div>
        </div>

        <!-- Culinary Experience -->
        <div class="experience-card exp-culinary">
          <div class="exp-category">CULINARY</div>
          <div class="experience-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 13.87A4 4 0 0 0 7.41 6.64a3.98 3.98 0 0 1 6.18 0A4 4 0 0 0 18 13.87v.01A8.002 8.002 0 0 1 12 20"></path>
              <line x1="12" y1="20" x2="12" y2="4"></line>
            </svg>
          </div>
          <h3>Gourmet Menu</h3>
          <p class="exp-spec">Chef-Curated Selection</p>
          <p class="exp-description">Beyond popcorn. Artisan snacks, craft beverages, and chef-inspired dishes prepared fresh daily</p>
          <div class="exp-badge">Elevated Dining</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <div id="footer-placeholder"></div>
  <script src="scripts/load-footer.js"></script>

  <!-- AUTH: Account Choice (Skip removed) -->
  <div class="overlay" id="choiceModal" aria-hidden="true">
    <div class="sheet">
      <button class="close-x" data-close="#choiceModal" aria-label="Close">âœ•</button>
      <h3>Welcome to THEATRUM</h3>
      <p class="sub">Choose how you want to start</p>
      <div class="btn-row" style="margin-bottom:12px">
        <button class="btn-primary" id="goLogin">Log In</button>
        <button class="btn-secondary" id="goSignup">Create Account</button>
        <button class="btn-secondary" id="goGuest">Continue as Guest</button>
        <button class="btn-secondary" id="logoutBtn" style="display:none">Log Out</button>
        <button class="btn-secondary" id="accountDashboardBtn" style="display:none">Account Dashboard</button>
      </div>
      <p class="muted">You can always create an account later for faster checkout and rewards.</p>
    </div>
  </div>

  <!-- AUTH: Login -->
  <div class="overlay" id="loginModal" aria-hidden="true">
    <div class="sheet">
      <button class="close-x" data-close="#loginModal" aria-label="Close">âœ•</button>
      <h3>Log In</h3>
      <p class="sub">Welcome back to premium cinema</p>
      <div class="stack">
        <div class="field"><label for="loginEmail">Email</label><input id="loginEmail" type="email" placeholder="you@example.com"/></div>
        <div class="field"><label for="loginPass">Password</label><input id="loginPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/></div>
        <label style="display:flex;gap:8px;align-items:center;color:var(--text-secondary);font-size:14px">
          <input id="rememberMe" type="checkbox" style="accent-color:#dc2626"> Remember me
        </label>
        <span id="loginError" class="error">Invalid email or password.</span>
        <div class="btn-row">
          <button id="loginSubmit" class="btn-primary">Sign In</button>
          <button class="btn-chip" data-swap="#loginModal,#signupModal">Create Account</button>
        </div>
      </div>
    </div>
  </div>

  <!-- AUTH: Signup -->
  <div class="overlay" id="signupModal" aria-hidden="true">
    <div class="sheet">
      <button class="close-x" data-close="#signupModal" aria-label="Close">âœ•</button>
      <h3>Create Account</h3>
      <p class="sub">Unlock faster checkout and member perks</p>
      <div class="stack">
        <div class="grid-2">
          <div class="field"><label for="firstName">First name</label><input id="firstName" placeholder="First Name"/></div>
          <div class="field"><label for="lastName">Last name</label><input id="lastName" placeholder="Last Name"/></div>
        </div>
        <div class="field"><label for="signupEmail">Email</label><input id="signupEmail" type="email" placeholder="you@example.com"/></div>
        <div class="field"><label for="signupPass">Password</label><input id="signupPass" type="password" placeholder="At least 8 characters"/></div>
        <span id="signupError" class="error">Please fill all fields correctly.</span>
        <div class="btn-row">
          <button id="signupSubmit" class="btn-primary">Create Account</button>
          <button class="btn-chip" data-swap="#signupModal,#loginModal">I already have an account</button>
        </div>
      </div>
    </div>
  </div>

  <!-- AUTH: Verify -->
  <div class="overlay" id="verifyModal" aria-hidden="true">
    <div class="sheet">
      <button class="close-x" data-close="#verifyModal" aria-label="Close">âœ•</button>
      <h3>Verify Your Email</h3>
      <p class="sub">We sent a 6-digit code to <span id="verifyEmailSpan" style="color:#f59e0b"></span></p>
      <div class="stack">
        <div class="field"><label for="verifyCode">Enter code</label><input id="verifyCode" inputmode="numeric" maxlength="6" placeholder="123456"/></div>
        <div class="btn-row">
          <button id="verifySubmit" class="btn-primary">Verify</button>
          <button class="btn-chip" id="resendCode">Resend Code</button>
        </div>
        <span id="verifyError" class="error">Invalid code. Try 123456 for demo.</span>
      </div>
    </div>
  </div>

  <!-- AUTH: Welcome -->
  <div class="overlay" id="welcomeModal" aria-hidden="true">
    <div class="sheet">
      <button class="close-x" data-close="#welcomeModal" aria-label="Close">âœ•</button>
      <h3>Welcome, <span id="welcomeName">Guest</span> ðŸŽ¬</h3>
      <p class="sub">Your account is ready. Letâ€™s book your next movie.</p>
      <div class="success show" id="welcomeBadge">Email verified. Membership perks unlocked.</div>
      <div class="btn-row" style="margin-top:12px">
        <button class="btn-primary" onclick="document.querySelector('#now-playing').scrollIntoView({behavior:'smooth'}); hide('#welcomeModal')">Start Booking</button>
      </div>
    </div>
  </div>

  <!-- BOOKING -->
  <div class="bottom-sheet" id="bookingSheet" aria-hidden="true">
    <div class="sheet-head">
      <div>
        <div class="kicker">BOOK TICKETS</div>
        <h4 id="sheetTitle">Movie</h4>
      </div>
      <button class="close-x" style="position:static" data-close="#bookingSheet" aria-label="Close">âœ•</button>
    </div>

    <div class="stack">
      <div class="field">
        <label>Pick a date</label>
        
        <!-- Dropdown Calendar -->
        <div id="calendarDropdown" class="calendar-dropdown">
          <div class="calendar-header">
            <button id="dropdownPrevBtn">â€¹</button>
            <span id="dropdownMonth">Month Year</span>
            <button id="dropdownNextBtn">â€º</button>
          </div>
          <div class="calendar-day-headers">
            <div>Sun</div>
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
          </div>
          <div id="dropdownCalendarDays" class="calendar-grid"></div>
        </div>
      </div>

      <div class="field" id="showtimesField">
        <label>Showtimes</label>
        <div class="showtime-row" id="timesRow"></div>
      </div>

      <div id="confirmMsg" class="success">Great! Your seats are reserved for <span id="confirmWhen"></span>. (Demo state)</div>

      <div class="btn-row" style="margin-top:10px">
        <button class="btn-primary" id="confirmBtn">Continue</button>
        <button class="btn-secondary" data-close="#bookingSheet">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Custom Date Picker Modal -->
  <div id="calendarModal" class="calendar-modal">
    <div class="calendar-sheet">
      <div class="calendar-head">
        <h3>Select Specific Date</h3>
        <button class="close-x" style="position:static" onclick="closeCalendar()">âœ•</button>
      </div>
      
      <div class="date-picker-container">
        <label>Pick a date</label>
        <input type="date" id="customDateInput" class="styled-date-input">
      </div>

      <div class="calendar-actions">
        <button class="btn-cancel" onclick="closeCalendar()">Cancel</button>
        <button class="btn-confirm" onclick="confirmCustomDate()">Confirm Date</button>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script>
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    
    // ... (Existing Helpers) ...
    
    // Trailer Logic (Merged)
    function initTrailerModal() {
        const trailerModal = $('#trailerModal');
        const trailerFrame = $('#trailerFrame');
        const trailerCloseBtn = $('.trailer-close-btn');
        const trailerTitle = $('#trailerTitle');
        const trailerDescription = $('#trailerDescription');

        if(trailerModal) {
            document.addEventListener('click', (e) => {
                const btn = e.target.closest('[data-action="trailer"]');
                if (btn) {
                    e.stopPropagation(); 
                    const card = btn.closest('.movie-card') || btn.closest('.coming-card');
                    const trailerId = card.dataset.trailer;
                    const movieTitle = card.dataset.title || card.querySelector('h3')?.textContent || 'Trailer';
                    
                    if (trailerId) {
                        trailerFrame.src = `https://www.youtube.com/embed/${trailerId}?autoplay=1&controls=1&modestbranding=1&rel=0&fs=1&cc_load_policy=1&iv_load_policy=3`;
                        
                        trailerFrame.onload = () => {
                            try {
                                const iframeDoc = trailerFrame.contentDocument || trailerFrame.contentWindow.document;
                                if (iframeDoc) {
                                    const style = iframeDoc.createElement('style');
                                    style.textContent = `
                                        button[aria-label="Share"], 
                                        .ytp-share-button,
                                        [data-tooltip-id="ytp-share-button"],
                                        .yt-simple-endpoint[aria-label*="Share"] {
                                            display: none !important;
                                            visibility: hidden !important;
                                        }
                                    `;
                                    iframeDoc.head.appendChild(style);
                                }
                            } catch(e) {
                                console.log('Cross-origin iframe - using CSS approach');
                            }
                        };
                        
                        trailerTitle.textContent = movieTitle;
                        trailerDescription.textContent = 'Watch the official trailer in high quality';
                        
                        trailerModal.classList.add('show');
                        document.body.style.overflow = 'hidden';
                    }
                }
            });

            function closeTrailer() {
                trailerModal.classList.remove('show');
                document.body.style.overflow = 'auto';
                setTimeout(() => { trailerFrame.src = ''; }, 300);
            }
            
            document.addEventListener('fullscreenchange', () => {
                // When exiting fullscreen, the modal should still be visible
            });
            
            if (trailerCloseBtn) {
                trailerCloseBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    closeTrailer();
                });
            }
            
            trailerModal.addEventListener('click', (e) => {
                if (e.target === trailerModal) closeTrailer();
            });
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && trailerModal.classList.contains('show')) {
                    closeTrailer();
                }
            });
        }
    }

    // Initialize trailer modal when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initTrailerModal);
    } else {
        initTrailerModal();
    }

    // ========== NOTIFY ME MODAL ==========
    function initNotifyModal() {
        const notifyModal = $('#notifyModal');
        const notifyCloseBtn = document.querySelector('.notify-close-btn');
        const notifyEmailInput = $('#notifyEmailInput');
        const notifyConfirmBtn = $('#notifyConfirmBtn');
        const notifyError = $('#notifyError');
        const notifyEmailState = $('#notifyEmailState');
        const notifyConfirmState = $('#notifyConfirmState');
        const notifyConfirmEmail = $('#notifyConfirmEmail');
        const notifyMovieTitle = $('#notifyMovieTitle');
        const notifyMovieTitleConfirm = $('#notifyMovieTitleConfirm');
        const notifyCloseConfirmBtn = $('#notifyCloseConfirmBtn');

        let currentMovieTitle = '';
        let userEmail = '';

        function openNotifyModal(movieTitle) {
            currentMovieTitle = movieTitle;
            notifyMovieTitle.textContent = movieTitle;
            notifyError.style.display = 'none';
            notifyEmailInput.value = '';

            // Check if user is logged in
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            if (currentUser && currentUser.email) {
                // User is logged in - show confirmation state
                userEmail = currentUser.email;
                notifyConfirmEmail.textContent = userEmail;
                notifyMovieTitleConfirm.textContent = movieTitle;
                notifyEmailState.style.display = 'none';
                notifyConfirmState.style.display = 'flex';
            } else {
                // User not logged in - show email input state
                notifyEmailState.style.display = 'flex';
                notifyConfirmState.style.display = 'none';
            }

            notifyModal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeNotifyModal() {
            notifyModal.classList.remove('show');
            document.body.style.overflow = 'auto';
            setTimeout(() => {
                notifyEmailState.style.display = 'flex';
                notifyConfirmState.style.display = 'none';
            }, 300);
        }

        // Validate email
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Handle confirm button click
        if (notifyConfirmBtn) {
            notifyConfirmBtn.addEventListener('click', () => {
                const email = notifyEmailInput.value.trim();

                if (!email) {
                    notifyError.textContent = 'Please enter your email';
                    notifyError.style.display = 'block';
                    return;
                }

                if (!validateEmail(email)) {
                    notifyError.textContent = 'Please enter a valid email';
                    notifyError.style.display = 'block';
                    return;
                }

                // Show confirmation with the entered email
                userEmail = email;
                notifyConfirmEmail.textContent = email;
                notifyMovieTitleConfirm.textContent = currentMovieTitle;
                notifyEmailState.style.display = 'none';
                notifyConfirmState.style.display = 'flex';

                // In a real app, you would save this notification preference to your backend
                console.log(`Notification saved for ${email} for movie: ${currentMovieTitle}`);
            });
        }

        // Handle Notify Me button clicks
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.btn-notify');
            if (btn) {
                e.preventDefault();
                e.stopPropagation();
                const card = btn.closest('.coming-card');
                const movieTitle = card.querySelector('h3')?.textContent || 'Movie';
                openNotifyModal(movieTitle);
            }
        });

        // Close modal handlers
        if (notifyCloseBtn) {
            notifyCloseBtn.addEventListener('click', closeNotifyModal);
        }

        if (notifyCloseConfirmBtn) {
            notifyCloseConfirmBtn.addEventListener('click', closeNotifyModal);
        }

        notifyModal.addEventListener('click', (e) => {
            if (e.target === notifyModal) closeNotifyModal();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && notifyModal.classList.contains('show')) {
                closeNotifyModal();
            }
        });
    }

    // Initialize notify modal when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initNotifyModal);
    } else {
        initNotifyModal();
    }

    // ========== TICKET BOOKING MODAL ==========
    function initTicketBooking() {
        const bookingModal = $('#ticketBookingModal');
        const heroCta = $('#hero-cta');
        const closeBtn = document.querySelector('.ticket-close-btn');
        const backBtn = $('#bookingBackBtn');
        const nextBtn = $('#bookingNextBtn');

        let currentStep = 1;
        let selectedFormat = null;
        let selectedDate = null;
        let selectedTime = null;
        let movieTitle = '';
        let movieGenre = '';

        // Format data with icons
        const formats = [
            { key: 'IMAX', label: 'IMAX', desc: 'Premium 70MM Format', icon: 'ðŸŽ¬', badge: 'Premium' },
            { key: 'DOLBY', label: 'Dolby Cinema', desc: 'Dolby Atmos Sound', icon: 'ðŸ”Š', badge: 'Audio' },
            { key: '3D', label: '3D Experience', desc: 'Enhanced Visuals', icon: 'ðŸ‘“', badge: 'Premium' },
            { key: 'STD', label: 'Standard', desc: 'Classic Format', icon: 'ðŸ“½ï¸', badge: 'Classic' }
        ];

        const timeSlots = ['10:00 AM', '1:00 PM', '4:30 PM', '7:00 PM', '10:00 PM'];

        // Open booking modal from hero CTA
        if (heroCta) {
            heroCta.addEventListener('click', () => {
                movieTitle = $('#hero-title')?.textContent || 'Movie';
                movieGenre = $('#hero-genre')?.textContent || 'Genre';
                
                $('#bookingMovieTitle').textContent = movieTitle;
                $('#bookingMovieGenre').textContent = movieGenre + ' â€¢ 2h 46m';
                
                resetBooking();
                bookingModal.classList.add('show');
                document.body.style.overflow = 'hidden';
            });
        }

        // Handle Coming Soon "Book Ticket" button clicks
        document.addEventListener('click', (e) => {
            const bookBtn = e.target.closest('.btn-book-coming');
            if (bookBtn) {
                const card = bookBtn.closest('.coming-card');
                if (card) {
                    movieTitle = card.querySelector('h3')?.textContent || 'Movie';
                    movieGenre = 'Coming Soon â€¢ Check Times';
                    
                    $('#bookingMovieTitle').textContent = movieTitle;
                    $('#bookingMovieGenre').textContent = movieGenre;
                    
                    resetBooking();
                    bookingModal.classList.add('show');
                    document.body.style.overflow = 'hidden';
                }
            }
        });

        // Close modal
        function closeBooking() {
            bookingModal.classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        if (closeBtn) {
            closeBtn.addEventListener('click', closeBooking);
        }

        bookingModal.addEventListener('click', (e) => {
            if (e.target === bookingModal) closeBooking();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && bookingModal.classList.contains('show')) {
                closeBooking();
            }
        });

        // Step navigation (only 2 steps now)
        function goToStep(step) {
            if (step < 1 || step > 2) return;

            // Validate current step before moving to next
            if (step > currentStep) {
                if (currentStep === 1 && !selectedFormat) {
                    // Show error feedback
                    const grid = $('#formatGrid');
                    grid.classList.add('shake');
                    setTimeout(() => grid.classList.remove('shake'), 500);
                    return;
                }
                if (currentStep === 2 && (!selectedDate || !selectedTime)) {
                    const splitDiv = document.querySelector('.date-time-split');
                    splitDiv.classList.add('shake');
                    setTimeout(() => splitDiv.classList.remove('shake'), 500);
                    return;
                }
            }

            // Hide all steps
            document.querySelectorAll('.booking-step').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));

            // Show new step
            $(`#step${step}`).classList.add('active');
            document.querySelector(`.step[data-step="${step}"]`)?.classList.add('active');

            currentStep = step;

            // Update buttons
            // Step 1: Show only Next button
            // Step 2: Show both Back and Next buttons
            if (step === 1) {
                backBtn.style.display = 'none';
                nextBtn.style.display = 'block';
            } else if (step === 2) {
                backBtn.style.display = 'block';
                nextBtn.style.display = 'block';
            }

            // Update progress line
            updateProgressLine();
        }

        // Format selection
        function generateFormats() {
            const grid = $('#formatGrid');
            grid.innerHTML = '';
            
            formats.forEach(format => {
                const div = document.createElement('div');
                div.className = 'format-option';
                div.innerHTML = `
                    <div class="format-icon">${format.icon}</div>
                    <div class="format-content">
                        <div class="format-name">${format.label}</div>
                        <div class="format-desc">${format.desc}</div>
                    </div>
                    <div class="format-badge">${format.badge}</div>
                `;
                div.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    document.querySelectorAll('.format-option').forEach(f => f.classList.remove('selected'));
                    div.classList.add('selected');
                    selectedFormat = format.label;
                    // Visual feedback only - NO auto-advance to next step
                    div.style.animation = 'none';
                    setTimeout(() => {
                        div.style.animation = 'pulse 0.3s ease';
                    }, 10);
                });
                grid.appendChild(div);
            });
        }

        // Update progress line
        function updateProgressLine() {
            const line = document.querySelector('.progress-line');
            if (line) {
                line.style.width = ((currentStep - 1) / 1) * 100 + '%';
            }
        }

        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        function generateCalendar(month, year) {
            const calendar = $('#bookingCalendar');
            const monthYear = $('#calendarMonth');
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            monthYear.textContent = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            const todayDate = today.getDate();
            const todayMonth = today.getMonth();
            const todayYear = today.getFullYear();

            calendar.innerHTML = '';

            // Day headers
            const dayHeaders = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendar.appendChild(header);
            });

            // Empty cells before first day
            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'calendar-day disabled';
                calendar.appendChild(empty);
            }

            // Days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.textContent = day;

                // Disable past dates
                if (year < todayYear || (year === todayYear && month < todayMonth) || 
                    (year === todayYear && month === todayMonth && day < todayDate)) {
                    dayDiv.classList.add('disabled');
                } else {
                    dayDiv.addEventListener('click', () => {
                        document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
                        dayDiv.classList.add('selected');
                        selectedDate = dayDiv.textContent + ' ' + monthNames[month];
                    });
                }

                // Mark today
                if (year === todayYear && month === todayMonth && day === todayDate) {
                    dayDiv.classList.add('today');
                }

                calendar.appendChild(dayDiv);
            }
        }

        // Time slot generation
        function generateTimeSlots() {
            const grid = $('#timeGrid');
            grid.innerHTML = '';
            
            timeSlots.forEach(time => {
                const div = document.createElement('div');
                div.className = 'time-option';
                div.textContent = time;
                div.addEventListener('click', () => {
                    document.querySelectorAll('.time-option').forEach(t => t.classList.remove('selected'));
                    div.classList.add('selected');
                    selectedTime = time;
                });
                grid.appendChild(div);
            });
        }

        // Button handlers
        nextBtn.addEventListener('click', () => {
            if (currentStep === 1) {
                // Step 1: Next button moves to Step 2 (date/time selection)
                goToStep(2);
            } else if (currentStep === 2) {
                // Step 2: Next button redirects to ticket selection page
                const bookingData = {
                    movie: movieTitle,
                    format: selectedFormat,
                    date: selectedDate,
                    time: selectedTime
                };
                let ticketTypeKey = 'standard';
                if (selectedFormat) {
                  const fmt = selectedFormat.toLowerCase();
                  if (fmt.includes('imax')) ticketTypeKey = 'imax';
                  else if (fmt.includes('dolby')) ticketTypeKey = 'dolby';
                  else if (fmt.includes('3d')) ticketTypeKey = '3d';
                  else ticketTypeKey = 'standard';
                }

                // Persist for ticket quantity + checkout
                localStorage.setItem('ticketType', ticketTypeKey);
                localStorage.setItem('currentShow', JSON.stringify({
                  movie: movieTitle,
                  format: selectedFormat,
                  date: selectedDate,
                  time: selectedTime
                }));
                window.location.href = 'ticket_quantity.html?booking=' + encodeURIComponent(JSON.stringify(bookingData));
            }
        });
        backBtn.addEventListener('click', () => goToStep(currentStep - 1));
        
        // Update button visibility on init - Step 1 shows only Next
        backBtn.style.display = 'none';
        nextBtn.style.display = 'block';

        // Calendar navigation

        $('#calendarPrev').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar(currentMonth, currentYear);
        });

        $('#calendarNext').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar(currentMonth, currentYear);
        });

        // Reset booking
        function resetBooking() {
            currentStep = 1;
            selectedFormat = null;
            selectedDate = null;
            selectedTime = null;
            currentMonth = new Date().getMonth();
            currentYear = new Date().getFullYear();
            
            generateFormats();
            generateCalendar(currentMonth, currentYear);
            generateTimeSlots();
            goToStep(1);
        }

        // Initialize
        generateFormats();
        generateCalendar(new Date().getMonth(), new Date().getFullYear());
        generateTimeSlots();
    }

    // Initialize booking modal when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initTicketBooking);
    } else {
        initTicketBooking();
    }

    const show = el => { el = typeof el==='string' ? $(el) : el; if(!el) return; el.classList.add('show'); el.setAttribute('aria-hidden','false'); };
    const hide = el => { el = typeof el==='string' ? $(el) : el; if(!el) return; el.classList.remove('show'); el.setAttribute('aria-hidden','true'); };
    window.show = show;
    window.hide = hide;

    // ... (Session Logic - Keep Existing) ...
    // ... (Header Logic - Keep Existing) ...

    // --- FILTER LOGIC ---
    const cards = Array.from(document.querySelectorAll('#moviesGrid .movie-card'));
    const moviesGrid = document.getElementById('moviesGrid');

    // State
    let activeGenres = new Set();
    let activeFormats = new Set();
    let currentDate = 'all';
    let currentLocation = localStorage.getItem('theatrum_location') || 'All Locations';
    
    // ========== TIME RANGE FILTER LOGIC ==========
    let selectedStartTime = 600; // 10:00 AM in minutes
    let selectedEndTime = 1320;   // 10:00 PM in minutes
    
    function minutesToTimeString(minutes) {
      const hours = Math.floor(minutes / 60);
      const mins = minutes % 60;
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const displayHours = hours > 12 ? hours - 12 : (hours === 0 ? 12 : hours);
      return `${displayHours}:${mins.toString().padStart(2, '0')} ${ampm}`;
    }
    
    function generateTimeOptions() {
      const times = [];
      for (let h = 10; h <= 22; h++) {
        for (let m = 0; m < 60; m += 30) {
          const minutes = h * 60 + m;
          times.push({ minutes, display: minutesToTimeString(minutes) });
        }
      }
      return times;
    }
    
    function renderTimeColumns() {
      const times = generateTimeOptions();
      const startCol = $('#startTimeColumn');
      const endCol = $('#endTimeColumn');
      
      // Clear existing time options (keep label)
      const startLabel = startCol.querySelector('.time-label');
      const endLabel = endCol.querySelector('.time-label');
      startCol.innerHTML = '';
      endCol.innerHTML = '';
      startCol.appendChild(startLabel.cloneNode(true));
      endCol.appendChild(endLabel.cloneNode(true));
      
      // Render start time options
      times.forEach(time => {
        const option = document.createElement('button');
        option.classList.add('time-option');
        option.textContent = time.display;
        if (time.minutes === selectedStartTime) option.classList.add('selected');
        option.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          if (time.minutes <= selectedEndTime) {
            selectedStartTime = time.minutes;
            updateTimeRangeDisplay();
            renderTimeColumns();
          }
        });
        startCol.appendChild(option);
      });
      
      // Render end time options
      times.forEach(time => {
        const option = document.createElement('button');
        option.classList.add('time-option');
        option.textContent = time.display;
        if (time.minutes === selectedEndTime) option.classList.add('selected');
        option.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          if (time.minutes >= selectedStartTime) {
            selectedEndTime = time.minutes;
            updateTimeRangeDisplay();
            renderTimeColumns();
          }
        });
        endCol.appendChild(option);
      });
    }
    
    function updateTimeRangeDisplay() {
      const startStr = minutesToTimeString(selectedStartTime);
      const endStr = minutesToTimeString(selectedEndTime);
      $('#timeRangeLabel').textContent = `${startStr} - ${endStr}`;
    }
    
    // Time range menu toggle
    let timeMenuOpen = false;
    $('#timeRangeTrigger').addEventListener('click', () => {
      timeMenuOpen = !timeMenuOpen;
      const menu = $('#timeRangeMenu');
      if (timeMenuOpen) {
        renderTimeColumns();
        menu.classList.add('show');
      } else {
        menu.classList.remove('show');
      }
    });
    
    // Apply time filter
    $('#applyTimeBtn').addEventListener('click', () => {
      timeMenuOpen = false;
      $('#timeRangeMenu').classList.remove('show');
      applyFilters();
    });
    
    // Close time menu when clicking outside
    document.addEventListener('click', (e) => {
      const timeRangeFilter = document.querySelector('.time-range-filter');
      const timeRangeMenu = $('#timeRangeMenu');
      
      // Check if click is outside the time range filter
      if (timeMenuOpen && !timeRangeFilter.contains(e.target)) {
        timeMenuOpen = false;
        timeRangeMenu.classList.remove('show');
      }
    });
    
    updateTimeRangeDisplay();
    
    // ========== CALENDAR IN DROPDOWN LOGIC ==========
    let dropdownCalendarMonth = new Date().getMonth();
    let dropdownCalendarYear = new Date().getFullYear();
    let dropdownSelectedDate = new Date();

    function generateCalendarGrid(month, year) {
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();
      
      const days = [];
      
      // Add empty slots for days before the first day
      for (let i = 0; i < startingDayOfWeek; i++) {
        days.push(null);
      }
      
      // Add days of the month
      for (let day = 1; day <= daysInMonth; day++) {
        days.push(new Date(year, month, day));
      }
      
      return days;
    }

    function renderDropdownCalendar(month, year) {
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                         'July', 'August', 'September', 'October', 'November', 'December'];
      
      // Update month/year display
      $('#dropdownMonthYear').textContent = `${monthNames[month]} ${year}`;
      
      // Generate and render calendar days
      const days = generateCalendarGrid(month, year);
      const gridContainer = $('#dropdownCalendarGrid');
      gridContainer.innerHTML = '';
      
      days.forEach(date => {
        const dayEl = document.createElement('button');
        dayEl.classList.add('calendar-grid-day');
        
        if (!date) {
          dayEl.classList.add('empty');
          dayEl.disabled = true;
        } else {
          const isToday = date.toDateString() === new Date().toDateString();
          const isSelected = date.toDateString() === dropdownSelectedDate.toDateString();
          
          dayEl.textContent = date.getDate();
          if (isToday) dayEl.classList.add('today');
          if (isSelected) dayEl.classList.add('selected');
          
          dayEl.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownSelectedDate = new Date(date);
            currentDate = dropdownSelectedDate.toISOString().split('T')[0];
            
            // Update the label
            const options = { month: 'short', day: 'numeric' };
            let labelText = dropdownSelectedDate.toLocaleDateString('en-US', options);
            document.getElementById('selectedDateLabel').textContent = labelText;
            
            // Close dropdown and apply filters
            document.getElementById('dateDropdown').classList.remove('is-open');
            applyFilters();
            
            // Re-render to show selection
            renderDropdownCalendar(dropdownCalendarMonth, dropdownCalendarYear);
          });
        }
        
        gridContainer.appendChild(dayEl);
      });
    }

    // Calendar navigation in dropdown
    $('#dropdownPrevBtn').addEventListener('click', (e) => {
      e.stopPropagation();
      dropdownCalendarMonth--;
      if (dropdownCalendarMonth < 0) {
        dropdownCalendarMonth = 11;
        dropdownCalendarYear--;
      }
      renderDropdownCalendar(dropdownCalendarMonth, dropdownCalendarYear);
    });
    
    $('#dropdownNextBtn').addEventListener('click', (e) => {
      e.stopPropagation();
      dropdownCalendarMonth++;
      if (dropdownCalendarMonth > 11) {
        dropdownCalendarMonth = 0;
        dropdownCalendarYear++;
      }
      renderDropdownCalendar(dropdownCalendarMonth, dropdownCalendarYear);
    });

    // Initial calendar render
    renderDropdownCalendar(dropdownCalendarMonth, dropdownCalendarYear);

    // Listen for Location Change (from Header)
    window.addEventListener('location-changed', (e) => {
        currentLocation = e.detail.location;
        applyFilters();
    });

    // Dropdown Toggles
    window.toggleDropdown = function(id) {
        const dropdown = document.getElementById(id);
        const allDropdowns = document.querySelectorAll('.filter-dropdown');
        allDropdowns.forEach(d => {
            if (d.id !== id) d.classList.remove('is-open');
        });
        dropdown.classList.toggle('is-open');
    };

    document.addEventListener('click', (e) => {
        if (!e.target.closest('.filter-dropdown') && !e.target.closest('.time-range-filter')) {
            document.querySelectorAll('.filter-dropdown').forEach(d => d.classList.remove('is-open'));
        }
    });

    // Listeners for Checkboxes
    document.querySelectorAll('#genreMenu input').forEach(cb => {
      cb.addEventListener('change', (e) => {
        if(e.target.checked) activeGenres.add(e.target.value);
        else activeGenres.delete(e.target.value);
        applyFilters();
      });
    });

    document.querySelectorAll('#formatMenu input').forEach(cb => {
      cb.addEventListener('change', (e) => {
        if(e.target.checked) activeFormats.add(e.target.value);
        else activeFormats.delete(e.target.value);
        applyFilters();
      });
    });

    document.querySelectorAll('#timeMenu input').forEach(cb => {
      cb.addEventListener('change', (e) => {
        if(e.target.checked) activeTimes.add(e.target.value);
        else activeTimes.delete(e.target.value);
        applyFilters();
      });
    });

    // --- CALENDAR LOGIC ---
    const calendarModal = document.getElementById('calendarModal');
    const customDateInput = document.getElementById('customDateInput');

    window.selectDate = function(val) {
        const dropdown = document.getElementById('dateDropdown');
        dropdown.classList.remove('is-open');

        if (val === 'calendar') {
            // This is no longer used with embedded calendar
            return;
        }

        // Preset Logic
        currentDate = val;
        
        const label = document.getElementById('selectedDateLabel');
        if(val === 'all') label.textContent = 'All Dates';
        else if(val === 'today') label.textContent = 'Today';
        else if(val === 'tomorrow') label.textContent = 'Tomorrow';
        
        applyFilters();
    };

    window.closeCalendar = function() {
        if(calendarModal) calendarModal.classList.remove('show');
    };

    window.confirmCustomDate = function() {
        if (!customDateInput) return;
        const rawDate = customDateInput.value;
        if (!rawDate) return;

        currentDate = rawDate;
        
        // Format Label
        const dateObj = new Date(rawDate + 'T00:00:00'); 
        const options = { month: 'short', day: 'numeric' };
        let labelText = dateObj.toLocaleDateString('en-US', options);
        
        document.getElementById('selectedDateLabel').textContent = labelText;
        
        closeCalendar();
        applyFilters();
    };

    // Parse "2:00 PM" to minutes
    function parseTimeStr(timeStr) {
        if(!timeStr) return 9999; 
        const [time, mod] = timeStr.split(' ');
        let [h, m] = time.split(':').map(Number);
        if(h === 12 && mod === 'AM') h = 0;
        if(h !== 12 && mod === 'PM') h += 12;
        return h * 60 + m;
    }

    // Helper: Check if any showtime falls within selected time range
    function hasShowtimeInRange(showtimeBtns) {
      return showtimeBtns.some(btn => {
        const t = parseTimeStr(btn.textContent);
        return t >= selectedStartTime && t <= selectedEndTime;
      });
    }

    // Sort Logic
    window.applySort = function(type, label) {
        document.getElementById('sortLabel').textContent = label;
        document.getElementById('sortDropdown').classList.remove('is-open');
        
        const sorted = [...cards].sort((a, b) => {
            if (type === 'showtime') {
                // Find earliest showtime button
                const getFirstTime = (card) => {
                    const btn = card.querySelector('.showtime-btn');
                    return btn ? parseTimeStr(btn.textContent) : 9999;
                };
                return getFirstTime(a) - getFirstTime(b);
            }
            if (type === 'title') return a.dataset.title.localeCompare(b.dataset.title);
            if (type === 'rating') return parseFloat(b.dataset.rating) - parseFloat(a.dataset.rating);
            if (type === 'release') return new Date(b.dataset.release) - new Date(a.dataset.release);
            return 0;
        });

        sorted.forEach(card => moviesGrid.appendChild(card));
    };

    // Main Filter Function
    function applyFilters() {
        cards.forEach(card => {
            // 1. Genres
            const cardGenres = card.dataset.genres.split(',').map(s => s.trim());
            const genreMatch = activeGenres.size === 0 || [...activeGenres].some(g => cardGenres.includes(g));

            // 2. Formats
            const cardFormats = (card.dataset.formats || '').split(',').map(s => s.trim());
            const formatMatch = activeFormats.size === 0 || [...activeFormats].some(f => cardFormats.includes(f));

            // 3. Location Check
            const cardLocations = (card.dataset.locations || '').split(',').map(s => s.trim());
            const locationMatch = (currentLocation === 'All Locations') || cardLocations.includes(currentLocation);

            // 4. Time Range Check
            const showtimeBtns = Array.from(card.querySelectorAll('.showtime-btn'));
            const timeMatch = hasShowtimeInRange(showtimeBtns);

            if (genreMatch && formatMatch && locationMatch && timeMatch) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    // Initial trigger
    applyFilters();

    // ========== COMING SOON CAROUSEL LOGIC ==========
    const comingSoonGrid = $('#comingSoonGrid');
    const comingSoonPrev = $('#comingSoonPrev');
    const comingSoonNext = $('#comingSoonNext');
    let comingSoonScrollPosition = 0;

    function scrollCarousel(direction) {
      const cardWidth = 280; // Width of card + gap
      const gap = 20;
      const scrollAmount = cardWidth + gap;
      
      if (direction === 'next') {
        comingSoonScrollPosition += scrollAmount;
      } else {
        comingSoonScrollPosition -= scrollAmount;
      }
      
      // Clamp scroll position
      const maxScroll = comingSoonGrid.scrollWidth - comingSoonGrid.parentElement.clientWidth;
      comingSoonScrollPosition = Math.max(0, Math.min(comingSoonScrollPosition, maxScroll));
      
      comingSoonGrid.scrollTo({
        left: comingSoonScrollPosition,
        behavior: 'smooth'
      });
      
      updateCarouselButtons();
    }

    function updateCarouselButtons() {
      const maxScroll = comingSoonGrid.scrollWidth - comingSoonGrid.parentElement.clientWidth;
      comingSoonPrev.disabled = comingSoonScrollPosition <= 0;
      comingSoonNext.disabled = comingSoonScrollPosition >= maxScroll;
    }

    comingSoonPrev.addEventListener('click', () => scrollCarousel('prev'));
    comingSoonNext.addEventListener('click', () => scrollCarousel('next'));

    // Update buttons on load and resize
    updateCarouselButtons();
    window.addEventListener('resize', updateCarouselButtons);

    // Calculate release countdown
    function updateReleaseCounts() {
      const now = new Date();
      document.querySelectorAll('.coming-card').forEach(card => {
        const releaseDate = new Date(card.dataset.releaseDate);
        const daysUntil = Math.ceil((releaseDate - now) / (1000 * 60 * 60 * 24));
        const countdownEl = card.querySelector('.release-countdown');
        
        if (countdownEl) {
          if (daysUntil <= 0) {
            countdownEl.textContent = 'Now Playing';
          } else if (daysUntil === 1) {
            countdownEl.textContent = 'Tomorrow';
          } else if (daysUntil <= 7) {
            countdownEl.textContent = `In ${daysUntil} days`;
          } else if (daysUntil <= 30) {
            const weeks = Math.ceil(daysUntil / 7);
            countdownEl.textContent = `In ${weeks} week${weeks > 1 ? 's' : ''}`;
          } else {
            const months = Math.ceil(daysUntil / 30);
            countdownEl.textContent = `In ${months} month${months > 1 ? 's' : ''}`;
          }
        }
      });
    }

    updateReleaseCounts();

    // ... (Rest of existing booking logic) ...
  </script>
  <script src="Functionality/index.js"></script>
  <script src="Functionality/theatrum_auth.js"></script>
  <script src="Functionality/theatrum_booking.js"></script>

  <!-- Premium Trailer Modal -->
  <div id="trailerModal" class="trailer-modal-overlay">
    <button class="trailer-close-btn" aria-label="Close trailer">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    
    <div class="trailer-modal-container">
      <div class="trailer-video-wrapper">
        <iframe 
          id="trailerFrame" 
          class="trailer-video-player" 
          allow="autoplay; encrypted-media; fullscreen"
          allowfullscreen>
        </iframe>
      </div>

      <div class="trailer-info-panel">
        <h2 id="trailerTitle" class="trailer-title">Movie Title</h2>
        <p id="trailerDescription" class="trailer-description">Trailer description will appear here</p>
      </div>
    </div>
  </div>

  <!-- Notify Me Modal -->
  <div id="notifyModal" class="notify-modal-overlay">
    <div class="notify-modal-container">
      <button class="notify-close-btn" aria-label="Close">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>

      <!-- Email Input State (for non-logged-in users) -->
      <div id="notifyEmailState" class="notify-state">
        <div class="notify-header">
          <h2 class="notify-title">Get Notified</h2>
          <p class="notify-subtitle" id="notifyMovieTitle">Movie Title</p>
        </div>

        <div class="notify-content">
          <p class="notify-message">Enter your email to be notified when this movie releases</p>
          <div class="notify-form">
            <input 
              type="email" 
              id="notifyEmailInput" 
              class="notify-input" 
              placeholder="Enter your email"
              aria-label="Email address"
            >
            <button id="notifyConfirmBtn" class="notify-btn-primary">Confirm</button>
          </div>
          <p class="notify-error" id="notifyError" style="display:none;"></p>
        </div>
      </div>

      <!-- Confirmation State -->
      <div id="notifyConfirmState" class="notify-state" style="display:none;">
        <div class="notify-header">
          <h2 class="notify-title">Notification Set! ðŸŽ¬</h2>
        </div>

        <div class="notify-content">
          <div class="notify-success-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
            </svg>
          </div>
          <p class="notify-confirmation-message">
            We'll send you an email to <strong id="notifyConfirmEmail"></strong> when <strong id="notifyMovieTitleConfirm"></strong> is released!
          </p>
          <button id="notifyCloseConfirmBtn" class="notify-btn-secondary">Done</button>
        </div>
      </div>
    </div>
  </div>

  <!-- TICKET BOOKING MODAL -->
  <div id="ticketBookingModal" class="ticket-modal-overlay">
    <div class="ticket-modal-container">
      <!-- Close Button -->
      <button class="ticket-close-btn" aria-label="Close booking">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>

      <!-- Movie Header -->
      <div class="ticket-header">
        <div class="ticket-header-content">
          <h2 id="bookingMovieTitle" class="ticket-movie-title">Movie Title</h2>
          <p id="bookingMovieGenre" class="ticket-movie-genre">Genre â€¢ Duration</p>
        </div>
      </div>

      <!-- Progress Indicator (2 steps) -->
      <div class="booking-progress">
        <div class="progress-track">
          <div class="progress-line"></div>
        </div>
        <div class="progress-steps">
          <div class="progress-step active" data-step="1">
            <div class="progress-circle">
              <span>1</span>
            </div>
            <span class="progress-label">Format</span>
          </div>
          <div class="progress-step" data-step="2">
            <div class="progress-circle">
              <span>2</span>
            </div>
            <span class="progress-label">Date & Time</span>
          </div>
        </div>
      </div>

      <!-- STEP 1: FORMAT SELECTION -->
      <div class="booking-step active" id="step1">
        <div class="step-header">
          <h3>Choose Your Experience</h3>
          <p>Select the format that best suits your preference</p>
        </div>
        <div class="format-grid" id="formatGrid">
          <!-- Formats will be populated dynamically -->
        </div>
      </div>

      <!-- STEP 2: DATE & TIME SELECTION -->
      <div class="booking-step" id="step2">
        <div class="step-header">
          <h3>Pick Your Time</h3>
          <p>Choose a date and time that works for you</p>
        </div>
        <div class="date-time-split">
          <!-- Calendar Column -->
          <div class="date-column">
            <div class="column-title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                <path d="M16 2v4M8 2v4M3 10h18"></path>
              </svg>
              Select Date
            </div>
            <div class="calendar-wrapper-compact">
              <div class="calendar-nav">
                <button class="calendar-prev-btn" id="calendarPrev">â€¹</button>
                <span class="calendar-month" id="calendarMonth">December 2025</span>
                <button class="calendar-next-btn" id="calendarNext">â€º</button>
              </div>
              <div class="calendar-compact" id="bookingCalendar">
                <!-- Calendar will be generated -->
              </div>
            </div>
          </div>

          <!-- Time Column -->
          <div class="time-column">
            <div class="column-title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              Select Time
            </div>
            <div class="time-grid-wrapper">
              <div class="time-grid" id="timeGrid">
                <!-- Times will be populated -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation Buttons -->
      <div class="booking-footer">
        <button class="btn-back" id="bookingBackBtn" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
          <span>Back</span>
        </button>
        <button class="btn-next" id="bookingNextBtn">
          <span>Next</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </button>
      </div>
    </div>
  </div>
</body>
</html>