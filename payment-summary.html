<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Theatrum — Payment Summary</title>
  <link rel="stylesheet" href="styles/index_styles.css" />
  <style>
    .checkout-shell {
      max-width: 1200px;
      margin: 120px auto 64px;
      padding: 0 32px;
    }
    .summary-layout {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(260px, 1.2fr);
      gap: 24px;
    }
    @media (max-width: 900px) {
      .summary-layout {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
    }
    .card h2 {
      font-size: 26px;
      margin-bottom: 8px;
    }
    .muted {
      color: var(--text-secondary);
      font-size: 14px;
    }
    .divider {
      height: 1px;
      background: var(--border);
      margin: 16px 0 20px;
    }
    .line-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin: 6px 0;
      font-size: 14px;
    }
    .line-label {
      color: var(--text-secondary);
    }
    .line-value {
      color: var(--text-primary);
      font-weight: 500;
    }
    .line-sub {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 2px;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--bg-secondary);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .pill.step-pill {
      background: rgba(74, 222, 128, 0.06);
      border-color: rgba(74, 222, 128, 0.3);
      color: #4ade80;
    }
    .section-title {
      font-size: 16px;
      margin-bottom: 4px;
    }
    .list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 14px;
    }
    .summary-total-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      font-size: 16px;
      font-weight: 600;
    }
    .summary-total-row span:last-child {
      font-size: 18px;
    }
    .sidebar-heading {
      font-size: 18px;
      margin-bottom: 6px;
    }
    .sidebar-section {
      margin-bottom: 16px;
    }
    .sidebar-section:last-child {
      margin-bottom: 0;
    }
    .sidebar-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 2px;
    }
    .sidebar-value {
      font-size: 14px;
      color: var(--text-primary);
      font-weight: 500;
    }
    .actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
    }
    .note {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="logo" id="logo">
        <span class="logo-thea">THEA</span><span class="logo-trum">TRUM</span>
      </div>
      <ul class="nav-links">
        <li><a href="#now-playing">Now Playing</a></li>
        <li><a href="#coming-soon">Coming Soon</a></li>
        <li><a href="#concessions">Food & Drinks</a></li>
        <li><a href="#offers">Offers</a></li>
        <li><a href="#locations">Locations</a></li>
      </ul>
      <div class="nav-actions">
        <div class="search-box">
          <input id="globalSearch" type="text" placeholder="Search movies..." />
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </div>
        <button id="userButton" class="btn-primary">Alex</button>
      </div>
    </div>
  </nav>

  <main class="checkout-shell">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:20px;">
      <span class="pill step-pill">Step 3 — Review & Confirm</span>
      <span class="muted" id="summary-helper">Make sure everything looks right before paying.</span>
    </div>

    <div class="summary-layout">
      <!-- Left: Detailed breakdown -->
      <section class="card">
        <h2>Payment summary</h2>
        <p class="muted" id="movie-label">
          Your tickets and snacks for tonight’s show.
        </p>
        <div class="divider"></div>

        <!-- Tickets -->
        <div class="section">
          <div class="section-title">Tickets</div>
          <div class="line-row">
            <div>
              <div class="line-label" id="ticket-summary-label">Tickets</div>
              <div class="line-sub" id="ticket-summary-sub">Type & quantity</div>
            </div>
            <div class="line-value" id="ticket-summary-amount">$0.00</div>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Snacks -->
        <div class="section">
          <div class="section-title">Snacks</div>
          <ul class="list" id="snack-list"></ul>
          <div class="line-row" style="margin-top:6px;">
            <span class="line-label">Snacks subtotal</span>
            <span class="line-value" id="snack-subtotal">$0.00</span>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Upsells -->
        <div class="section">
          <div class="section-title">Extras</div>
          <ul class="list" id="upsell-list"></ul>
          <div class="line-row" style="margin-top:6px;">
            <span class="line-label">Extras subtotal</span>
            <span class="line-value" id="upsell-subtotal">$0.00</span>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Total -->
        <div class="summary-total-row">
          <span>Total</span>
          <span id="summary-total">$0.00</span>
        </div>
        <p class="note">Taxes and fees will be calculated on the next step.</p>
      </section>

      <!-- Right: Compact order info + actions -->
      <aside class="card">
        <h3 class="sidebar-heading">Your booking</h3>

        <div class="sidebar-section">
          <div class="sidebar-label">Tickets</div>
          <div class="sidebar-value" id="sidebar-ticket-line">0 × Standard</div>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-label">Seats</div>
          <div class="sidebar-value" id="sidebar-seats">None selected</div>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-label">Estimated total</div>
          <div class="sidebar-value" id="sidebar-total">$0.00</div>
          <div class="note">Final total confirmed on payment page.</div>
        </div>

        <div class="actions">
          <button class="btn-secondary" id="back-button">
            ← Back
          </button>
          <button class="btn-primary" id="proceed-payment">
            Proceed to payment
          </button>
          <button class="btn-secondary" id="edit-snacks">
            Edit snacks & extras
          </button>
          <button class="btn-secondary" id="edit-seats">
            Change seats
          </button>
        </div>
      </aside>
    </div>
  </main>

  <!-- Footer (same as other pages) -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <div class="footer-logo">
            <span class="logo-thea">THEA</span><span class="logo-trum">TRUM</span>
          </div>
          <p>Experience cinema the way it was meant to be seen.</p>
        </div>
        <div class="footer-section">
          <h4>Customer Support</h4>
          <ul>
            <li><a href="#">Help Center</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Accessibility</a></li>
            <li><a href="#">Careers</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Newsletter</h4>
          <p>Get the latest movies and exclusive offers</p>
          <div class="newsletter-form">
            <input type="email" placeholder="Your email" />
            <button class="btn-primary">Subscribe</button>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 THEATRUM. All rights reserved.</p>
        <div class="footer-links">
          <a href="#">Privacy Policy</a>
          <a href="#">Terms of Service</a>
          <a href="#">Cookie Settings</a>
        </div>
      </div>
    </div>
  </footer>

  <script src="scripts/booking.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      function safeParseInt(v) {
        var n = parseInt(v, 10);
        return isNaN(n) ? 0 : n;
      }
      function safeParseFloat(v, fallback) {
        var n = parseFloat(v);
        return isNaN(n) ? (fallback || 0) : n;
      }

      var ticketQty = safeParseInt(localStorage.getItem('ticketQty'));
      var ticketType = localStorage.getItem('ticketType') || 'standard';
      var ticketUnitPrice = safeParseFloat(localStorage.getItem('ticketUnitPrice'), 12.0);
      var seats = [];
      try {
        seats = JSON.parse(localStorage.getItem('selectedSeats') || '[]');
      } catch (e) {
        seats = [];
      }

      // from booking.js helper (already loaded)
      var foodOrder = {};
      if (typeof getNormalizedFoodOrder === 'function') {
        foodOrder = getNormalizedFoodOrder();
      } else {
        try {
          foodOrder = JSON.parse(localStorage.getItem('foodOrder') || '{}');
        } catch (e) {
          foodOrder = {};
        }
      }

      var upsellCart = [];
      try {
        upsellCart = JSON.parse(localStorage.getItem('upsellCart') || '[]');
      } catch (e) {
        upsellCart = [];
      }

      // DOM refs
      var ticketSummaryLabel = document.getElementById('ticket-summary-label');
      var ticketSummarySub = document.getElementById('ticket-summary-sub');
      var ticketSummaryAmount = document.getElementById('ticket-summary-amount');

      var snackListEl = document.getElementById('snack-list');
      var snackSubtotalEl = document.getElementById('snack-subtotal');

      var upsellListEl = document.getElementById('upsell-list');
      var upsellSubtotalEl = document.getElementById('upsell-subtotal');

      var summaryTotalEl = document.getElementById('summary-total');

      var sidebarTicketLine = document.getElementById('sidebar-ticket-line');
      var sidebarSeats = document.getElementById('sidebar-seats');
      var sidebarTotal = document.getElementById('sidebar-total');

      // Tickets
      var ticketLabelType = ticketType === '3d' ? '3D' : 'Standard';
      if (ticketSummaryLabel) {
        ticketSummaryLabel.textContent = ticketQty + ' × ' + ticketLabelType + ' ticket' + (ticketQty === 1 ? '' : 's');
      }
      if (ticketSummarySub) {
        ticketSummarySub.textContent = '$' + ticketUnitPrice.toFixed(2) + ' each';
      }
      var ticketSubtotal = ticketQty * ticketUnitPrice;
      if (ticketSummaryAmount) {
        ticketSummaryAmount.textContent = '$' + ticketSubtotal.toFixed(2);
      }

      // Snacks
      var snacksTotal = 0;
      snackListEl.innerHTML = '';
      var foodKeys = Object.keys(foodOrder || {});
      if (foodKeys.length) {
        foodKeys.forEach(function (k) {
          var it = foodOrder[k];
          if (!it) return;
          var qty = safeParseInt(it.qty);
          var unitPrice = safeParseFloat(it.price, 0);
          if (qty <= 0) return;
          var line = qty * unitPrice;
          snacksTotal += line;

          var li = document.createElement('li');
          var label = it.name || k;
          if (it.size) label += ' (' + it.size + ')';
          li.textContent = label + ' × ' + qty + ' — $' + line.toFixed(2);
          snackListEl.appendChild(li);
        });
      } else {
        var liEmpty = document.createElement('li');
        liEmpty.textContent = 'No snacks selected.';
        snackListEl.appendChild(liEmpty);
      }
      snackSubtotalEl.textContent = '$' + snacksTotal.toFixed(2);

      // Upsells
      var upsellTotal = 0;
      upsellListEl.innerHTML = '';
      if (Array.isArray(upsellCart) && upsellCart.length) {
        var map = {};
        upsellCart.forEach(function (u) {
          var key = u.item || String(u);
          var price = safeParseFloat(u.price, 0);
          if (!map[key]) map[key] = { qty: 0, price: price };
          map[key].qty += 1;
        });
        Object.keys(map).forEach(function (k) {
          var it = map[k];
          var line = it.qty * it.price;
          upsellTotal += line;
          var li = document.createElement('li');
          li.textContent = k + ' × ' + it.qty + ' — $' + line.toFixed(2);
          upsellListEl.appendChild(li);
        });
      } else {
        var liNoUps = document.createElement('li');
        liNoUps.textContent = 'No extras added.';
        upsellListEl.appendChild(liNoUps);
      }
      upsellSubtotalEl.textContent = '$' + upsellTotal.toFixed(2);

      // Grand total (before tax/fees)
      var grandTotal = ticketSubtotal + snacksTotal + upsellTotal;
      summaryTotalEl.textContent = '$' + grandTotal.toFixed(2);
      sidebarTotal.textContent = '$' + grandTotal.toFixed(2);

      // Sidebar text
      if (sidebarTicketLine) {
        sidebarTicketLine.textContent =
          ticketQty +
          ' × ' +
          ticketLabelType +
          ' ticket' +
          (ticketQty === 1 ? '' : 's');
      }
      if (sidebarSeats) {
        sidebarSeats.textContent = seats && seats.length ? seats.join(', ') : 'None selected';
      }

      // Actions
      var proceedPaymentBtn = document.getElementById('proceed-payment');
      var editSnacksBtn = document.getElementById('edit-snacks');
      var editSeatsBtn = document.getElementById('edit-seats');
      var backBtn = document.getElementById('back-button');

      if (proceedPaymentBtn) {
        proceedPaymentBtn.addEventListener('click', function () {
          window.location.href = 'paymentcard.html';
        });
      }

      if (backBtn) {
        backBtn.addEventListener('click', function () {
          // Go back in browser history if possible
          if (window.history.length > 1) {
            window.history.back();
          } else {
            // Fallback if history is not available
            window.location.href = 'checkout.html';
          }
        });
      }

      if (editSnacksBtn) {
        editSnacksBtn.addEventListener('click', function () {
          window.location.href = 'food_selection.html';
        });
      }
      if (editSeatsBtn) {
        editSeatsBtn.addEventListener('click', function () {
          window.location.href = 'seat_selection.html';
        });
      }
    });
  </script>
</body>
</html>
